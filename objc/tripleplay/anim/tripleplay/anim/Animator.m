//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/anim/Animator.java
//
//  Created by Thomas on 7/1/13.
//

#import "java/util/ArrayList.h"
#import "java/util/List.h"
#import "playn/core/util/Clock.h"
#import "tripleplay/anim/Animation.h"

@implementation TripleplayAnimAnimator

- (id<JavaUtilList>)_anims {
  return _anims_;
}
- (void)set_anims:(id<JavaUtilList>)_anims {
  JreOperatorRetainedAssign(&_anims_, self, _anims);
}
@synthesize _anims = _anims_;
- (id<JavaUtilList>)_nanims {
  return _nanims_;
}
- (void)set_nanims:(id<JavaUtilList>)_nanims {
  JreOperatorRetainedAssign(&_nanims_, self, _nanims);
}
@synthesize _nanims = _nanims_;
- (id<JavaUtilList>)_accum {
  return _accum_;
}
- (void)set_accum:(id<JavaUtilList>)_accum {
  JreOperatorRetainedAssign(&_accum_, self, _accum);
}
@synthesize _accum = _accum_;
- (id<JavaUtilList>)_barriers {
  return _barriers_;
}
- (void)set_barriers:(id<JavaUtilList>)_barriers {
  JreOperatorRetainedAssign(&_barriers_, self, _barriers);
}
@synthesize _barriers = _barriers_;

+ (TripleplayAnimAnimator *)create {
  return [[[TripleplayAnimAnimator alloc] init] autorelease];
}

- (void)addBarrier {
  [self addBarrierWithFloat:0];
}

- (void)addBarrierWithFloat:(float)delay {
  TripleplayAnimAnimator_Barrier *barrier = [[[TripleplayAnimAnimator_Barrier alloc] initWithFloat:delay] autorelease];
  [((id<JavaUtilList>) NIL_CHK(_barriers_)) addWithId:barrier];
  JreOperatorRetainedAssign(&_accum_, self, ((TripleplayAnimAnimator_Barrier *) NIL_CHK(barrier)).accum);
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  float time = [((id<PlaynCoreUtilClock>) NIL_CHK(clock)) time];
  if (![((id<JavaUtilList>) NIL_CHK(_nanims_)) isEmpty]) {
    for (int ii = 0, ll = [((id<JavaUtilList>) NIL_CHK(_nanims_)) size]; ii < ll; ii++) {
      [((TripleplayAnimAnimation *) [((id<JavaUtilList>) NIL_CHK(_nanims_)) getWithInt:ii]) init__WithFloat:time];
    }
    [((id<JavaUtilList>) NIL_CHK(_anims_)) addAllWithJavaUtilCollection:_nanims_];
    [((id<JavaUtilList>) NIL_CHK(_nanims_)) clear];
  }
  for (int ii = 0, ll = [((id<JavaUtilList>) NIL_CHK(_anims_)) size]; ii < ll; ii++) {
    if ([((TripleplayAnimAnimation *) [((id<JavaUtilList>) NIL_CHK(_anims_)) getWithInt:ii]) applyWithTripleplayAnimAnimator:self withFloat:time] <= 0) {
      (void) [((id<JavaUtilList>) NIL_CHK(_anims_)) removeWithInt:ii--];
      ll -= 1;
    }
  }
  BOOL noActiveAnims = [((id<JavaUtilList>) NIL_CHK(_anims_)) isEmpty] && [((id<JavaUtilList>) NIL_CHK(_nanims_)) isEmpty];
  if (![((id<JavaUtilList>) NIL_CHK(_barriers_)) isEmpty] && (noActiveAnims || [((TripleplayAnimAnimator_Barrier *) [((id<JavaUtilList>) NIL_CHK(_barriers_)) getWithInt:0]) expiredWithFloat:time])) {
    TripleplayAnimAnimator_Barrier *barrier = ((TripleplayAnimAnimator_Barrier *) [((id<JavaUtilList>) NIL_CHK(_barriers_)) removeWithInt:0]);
    [((id<JavaUtilList>) NIL_CHK(_nanims_)) addAllWithJavaUtilCollection:((TripleplayAnimAnimator_Barrier *) NIL_CHK(barrier)).accum];
    if ([((id<JavaUtilList>) NIL_CHK(_barriers_)) isEmpty]) {
      JreOperatorRetainedAssign(&_accum_, self, _nanims_);
    }
  }
}

- (void)clear {
  [((id<JavaUtilList>) NIL_CHK(_anims_)) clear];
  [((id<JavaUtilList>) NIL_CHK(_nanims_)) clear];
  [((id<JavaUtilList>) NIL_CHK(_barriers_)) clear];
  JreOperatorRetainedAssign(&_accum_, self, _nanims_);
}

- (id)addWithId:(TripleplayAnimAnimation *)anim {
  [((id<JavaUtilList>) NIL_CHK(_accum_)) addWithId:anim];
  return anim;
}

- (id)init {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&_anims_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
    JreOperatorRetainedAssign(&_nanims_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
    JreOperatorRetainedAssign(&_accum_, self, _nanims_);
    JreOperatorRetainedAssign(&_barriers_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&_barriers_, self, nil);
  JreOperatorRetainedAssign(&_accum_, self, nil);
  JreOperatorRetainedAssign(&_nanims_, self, nil);
  JreOperatorRetainedAssign(&_anims_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayAnimAnimator *typedCopy = (TripleplayAnimAnimator *) copy;
  typedCopy._anims = _anims_;
  typedCopy._nanims = _nanims_;
  typedCopy._accum = _accum_;
  typedCopy._barriers = _barriers_;
}

@end
@implementation TripleplayAnimAnimator_Barrier

- (id<JavaUtilList>)accum {
  return accum_;
}
- (void)setAccum:(id<JavaUtilList>)accum {
  JreOperatorRetainedAssign(&accum_, self, accum);
}
@synthesize accum = accum_;
@synthesize expireDelay = expireDelay_;
@synthesize absoluteExpireTime = absoluteExpireTime_;

- (id)initWithFloat:(float)expireDelay {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&accum_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
    self.expireDelay = expireDelay;
  }
  return self;
}

- (BOOL)expiredWithFloat:(float)time {
  if (expireDelay_ == 0) return NO;
  if (absoluteExpireTime_ == 0) absoluteExpireTime_ = time + expireDelay_;
  return time > absoluteExpireTime_;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&accum_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayAnimAnimator_Barrier *typedCopy = (TripleplayAnimAnimator_Barrier *) copy;
  typedCopy.accum = accum_;
  typedCopy.expireDelay = expireDelay_;
  typedCopy.absoluteExpireTime = absoluteExpireTime_;
}

@end
