//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: C:\Users\Thomas\Documents\Eclipse\Tux\tuxblocks\core\src\main\java\tuxkids\tuxblocks\core\solve\expression\EquationGenerator.java
//
//  Created by Thomas on 7/1/13.
//

#import "IOSObjectArray.h"
#import "java/lang/IllegalArgumentException.h"
#import "java/lang/Integer.h"
#import "java/lang/Math.h"
#import "java/util/ArrayList.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"
#import "java/util/Random.h"
#import "tuxkids/tuxblocks/core/solve/expression/Equation.h"
#import "tuxkids/tuxblocks/core/solve/expression/EquationGenerator.h"
#import "tuxkids/tuxblocks/core/solve/expression/Expression.h"
#import "tuxkids/tuxblocks/core/solve/expression/Number.h"
#import "tuxkids/tuxblocks/core/solve/expression/Variable.h"

@implementation TBEquationGenerator

static JavaUtilRandom * TBEquationGenerator_random_;
static id<JavaUtilList> TBEquationGenerator_primes_;

+ (JavaUtilRandom *)random {
  return TBEquationGenerator_random_;
}

+ (id<JavaUtilList>)primes {
  return TBEquationGenerator_primes_;
}

+ (TBEquation *)generateWithInt:(int)steps {
  int answer = [((JavaUtilRandom *) NIL_CHK(TBEquationGenerator_random_)) nextIntWithInt:TBEquationGenerator_MAX_ANSWER * 2 + 1] - TBEquationGenerator_MAX_ANSWER;
  double difficulty = answer / 3;
  int rhs = answer;
  TBExpression *lhs = [[[TBVariable alloc] initWithNSString:@"x"] autorelease];
  TBEquationGenerator_OperationEnum *lastOperation = nil;
  TBEquationGenerator_OperationEnum *lastOperationInv = nil;
  JavaLangInteger *lastTimes = nil;
  for (int i = 0; i < steps; i++) {
    id<JavaUtilList> factors = [TBEquationGenerator getFactorsWithInt:rhs];
    if (lastTimes != nil) [((id<JavaUtilList>) NIL_CHK(factors)) removeWithId:lastTimes];
    id<JavaUtilList> operations = [[[JavaUtilArrayList alloc] init] autorelease];
    {
      IOSObjectArray *a__ = [TBEquationGenerator_OperationEnum values];
      int n__ = (int) [((IOSObjectArray *) NIL_CHK(a__)) count];
      for (int i__ = 0; i__ < n__; i__++) {
        TBEquationGenerator_OperationEnum *operation = ((TBEquationGenerator_OperationEnum *) [((IOSObjectArray *) NIL_CHK(a__)) objectAtIndex:i__]);
        [((id<JavaUtilList>) NIL_CHK(operations)) addWithId:operation];
      }
    }
    if ([((id<JavaUtilList>) NIL_CHK(factors)) isEmpty]) [((id<JavaUtilList>) NIL_CHK(operations)) removeWithId:[TBEquationGenerator_OperationEnum Over]];
    if (lastOperation != nil) [((id<JavaUtilList>) NIL_CHK(operations)) removeWithId:lastOperation];
    int maxTimes = TBEquationGenerator_MAX_TIMES;
    if (rhs != 0) maxTimes = [JavaLangMath minWithInt:maxTimes withInt:[JavaLangMath absWithInt:TBEquationGenerator_MAX_RHS / rhs]];
    if (maxTimes <= TBEquationGenerator_MIN_TIMES) [((id<JavaUtilList>) NIL_CHK(operations)) removeWithId:[TBEquationGenerator_OperationEnum Times]];
    if ([((id<JavaUtilList>) NIL_CHK(operations)) size] > 1 && lastOperationInv != nil) [((id<JavaUtilList>) NIL_CHK(operations)) removeWithId:lastOperationInv];
    TBEquationGenerator_OperationEnum *operation = ((TBEquationGenerator_OperationEnum *) [((id<JavaUtilList>) NIL_CHK(operations)) getWithInt:[((JavaUtilRandom *) NIL_CHK(TBEquationGenerator_random_)) nextIntWithInt:[((id<JavaUtilList>) NIL_CHK(operations)) size]]]);
    lastOperation = operation;
    lastTimes = nil;
    double ds = difficulty;
    int r = rhs;
    int value;
    if (operation == [TBEquationGenerator_OperationEnum Plus]) {
      lastOperationInv = [TBEquationGenerator_OperationEnum Minus];
      value = [((JavaUtilRandom *) NIL_CHK(TBEquationGenerator_random_)) nextIntWithInt:TBEquationGenerator_MAX_ADD_SUB - 1] + 1;
      difficulty += TBEquationGenerator_PLUS_DIFFICULTY * [JavaLangMath minWithInt:[JavaLangMath absWithInt:value] withInt:[JavaLangMath absWithInt:rhs]];
      lhs = [((TBExpression *) NIL_CHK(lhs)) plusWithInt:value];
      rhs += value;
    }
    else if (operation == [TBEquationGenerator_OperationEnum Minus]) {
      lastOperationInv = [TBEquationGenerator_OperationEnum Plus];
      value = [((JavaUtilRandom *) NIL_CHK(TBEquationGenerator_random_)) nextIntWithInt:TBEquationGenerator_MAX_ADD_SUB - 1] + 1;
      difficulty += TBEquationGenerator_MINUS_DIFFICULTY * [JavaLangMath minWithInt:[JavaLangMath absWithInt:value] withInt:[JavaLangMath absWithInt:rhs]];
      lhs = [((TBExpression *) NIL_CHK(lhs)) minusWithInt:value];
      rhs -= value;
    }
    else if (operation == [TBEquationGenerator_OperationEnum Times]) {
      lastOperationInv = [TBEquationGenerator_OperationEnum Over];
      value = [((JavaUtilRandom *) NIL_CHK(TBEquationGenerator_random_)) nextIntWithInt:maxTimes - TBEquationGenerator_MIN_TIMES] + TBEquationGenerator_MIN_TIMES;
      lhs = [((TBExpression *) NIL_CHK(lhs)) timesWithInt:value];
      rhs *= value;
      lastTimes = [JavaLangInteger valueOfWithInt:value];
      difficulty += TBEquationGenerator_TIMES_DIFFICULTY * [JavaLangMath sqrtWithDouble:[JavaLangMath absWithInt:rhs]];
    }
    else {
      lastOperationInv = [TBEquationGenerator_OperationEnum Times];
      value = [((JavaLangInteger *) [((id<JavaUtilList>) NIL_CHK(factors)) getWithInt:[((JavaUtilRandom *) NIL_CHK(TBEquationGenerator_random_)) nextIntWithInt:[((id<JavaUtilList>) NIL_CHK(factors)) size]]]) intValue];
      difficulty += TBEquationGenerator_DIVIDE_DIFFICULTY * [JavaLangMath sqrtWithDouble:[JavaLangMath absWithInt:rhs]];
      lhs = [((TBExpression *) NIL_CHK(lhs)) overWithInt:value];
      rhs /= value;
    }
    difficulty += TBEquationGenerator_MIN_DIFFICULTY;
    ds = difficulty - ds;
  }
  return [[[TBEquation alloc] initWithTBExpression:lhs withTBExpression:[[[TBNumber alloc] initWithInt:rhs] autorelease] withInt:answer withInt:(int) difficulty] autorelease];
}

+ (id<JavaUtilList>)getFactorsWithInt:(int)n {
  id<JavaUtilList> factors = [[[JavaUtilArrayList alloc] init] autorelease];
  n = [JavaLangMath absWithInt:n];
  if (n < 3) return factors;
  double max = [JavaLangMath sqrtWithDouble:n];
  int pIndex = 0;
  int prime = [TBEquationGenerator getPrimeWithInt:pIndex++];
  while (prime <= max) {
    if (n % prime == 0) {
      if (n / prime == 1) break;
      [((id<JavaUtilList>) NIL_CHK(factors)) addWithId:[JavaLangInteger valueOfWithInt:prime]];
      if (![((id<JavaUtilList>) NIL_CHK(factors)) containsWithId:[JavaLangInteger valueOfWithInt:n / prime]]) [((id<JavaUtilList>) NIL_CHK(factors)) addWithId:[JavaLangInteger valueOfWithInt:n / prime]];
      id<JavaUtilList> subprimes = [TBEquationGenerator getFactorsWithInt:n / prime];
      {
        id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(subprimes)) iterator]);
        while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
          JavaLangInteger *subprime = ((JavaLangInteger *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
          if (![((id<JavaUtilList>) NIL_CHK(factors)) containsWithId:subprime]) [((id<JavaUtilList>) NIL_CHK(factors)) addWithId:subprime];
          if (![((id<JavaUtilList>) NIL_CHK(factors)) containsWithId:[JavaLangInteger valueOfWithInt:[((JavaLangInteger *) NIL_CHK(subprime)) intValue] * prime]]) [((id<JavaUtilList>) NIL_CHK(factors)) addWithId:[JavaLangInteger valueOfWithInt:[((JavaLangInteger *) NIL_CHK(subprime)) intValue] * prime]];
        }
      }
      break;
    }
    else {
      prime = [TBEquationGenerator getPrimeWithInt:pIndex++];
    }
  }
  return factors;
}

+ (int)getPrimeWithInt:(int)index {
  while (index >= [((id<JavaUtilList>) NIL_CHK(TBEquationGenerator_primes_)) size]) {
    int possible = [((JavaLangInteger *) [((id<JavaUtilList>) NIL_CHK(TBEquationGenerator_primes_)) getWithInt:[((id<JavaUtilList>) NIL_CHK(TBEquationGenerator_primes_)) size] - 1]) intValue] + 1;
    while (![TBEquationGenerator isPrimeSoFarWithInt:possible]) possible++;
    [((id<JavaUtilList>) NIL_CHK(TBEquationGenerator_primes_)) addWithId:[JavaLangInteger valueOfWithInt:possible]];
  }
  return [((JavaLangInteger *) [((id<JavaUtilList>) NIL_CHK(TBEquationGenerator_primes_)) getWithInt:index]) intValue];
}

+ (BOOL)isPrimeSoFarWithInt:(int)n {
  double max = [JavaLangMath sqrtWithDouble:n];
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(TBEquationGenerator_primes_)) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      int prime = [((JavaLangInteger *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]) intValue];
      if (prime > max) break;
      if (n % prime == 0) return NO;
    }
  }
  return YES;
}

- (id)init {
  return [super init];
}

+ (void)initialize {
  if (self == [TBEquationGenerator class]) {
    JreOperatorRetainedAssign(&TBEquationGenerator_random_, self, [[[JavaUtilRandom alloc] init] autorelease]);
    JreOperatorRetainedAssign(&TBEquationGenerator_primes_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
    {
      [((id<JavaUtilList>) NIL_CHK(TBEquationGenerator_primes_)) addWithId:[JavaLangInteger valueOfWithInt:2]];
    }
  }
}

- (void)dealloc {
  [super dealloc];
}

@end

static TBEquationGenerator_OperationEnum *TBEquationGenerator_OperationEnum_Plus;
static TBEquationGenerator_OperationEnum *TBEquationGenerator_OperationEnum_Minus;
static TBEquationGenerator_OperationEnum *TBEquationGenerator_OperationEnum_Times;
static TBEquationGenerator_OperationEnum *TBEquationGenerator_OperationEnum_Over;
IOSObjectArray *TBEquationGenerator_OperationEnum_values;

@implementation TBEquationGenerator_OperationEnum

+ (TBEquationGenerator_OperationEnum *)Plus {
  return TBEquationGenerator_OperationEnum_Plus;
}
+ (TBEquationGenerator_OperationEnum *)Minus {
  return TBEquationGenerator_OperationEnum_Minus;
}
+ (TBEquationGenerator_OperationEnum *)Times {
  return TBEquationGenerator_OperationEnum_Times;
}
+ (TBEquationGenerator_OperationEnum *)Over {
  return TBEquationGenerator_OperationEnum_Over;
}

- (id)copyWithZone:(NSZone *)zone {
  return [self retain];
}

- (id)initWithNSString:(NSString *)name withInt:(int)ordinal {
  return [super initWithNSString:name withInt:ordinal];
}

+ (void)initialize {
  if (self == [TBEquationGenerator_OperationEnum class]) {
    TBEquationGenerator_OperationEnum_Plus = [[TBEquationGenerator_OperationEnum alloc] initWithNSString:@"Plus" withInt:0];
    TBEquationGenerator_OperationEnum_Minus = [[TBEquationGenerator_OperationEnum alloc] initWithNSString:@"Minus" withInt:1];
    TBEquationGenerator_OperationEnum_Times = [[TBEquationGenerator_OperationEnum alloc] initWithNSString:@"Times" withInt:2];
    TBEquationGenerator_OperationEnum_Over = [[TBEquationGenerator_OperationEnum alloc] initWithNSString:@"Over" withInt:3];
    TBEquationGenerator_OperationEnum_values = [[IOSObjectArray alloc] initWithObjects:(id[]){ TBEquationGenerator_OperationEnum_Plus, TBEquationGenerator_OperationEnum_Minus, TBEquationGenerator_OperationEnum_Times, TBEquationGenerator_OperationEnum_Over, nil } count:4 type:[IOSClass classWithClass:[TBEquationGenerator_OperationEnum class]]];
  }
}

+ (IOSObjectArray *)values {
  return [IOSObjectArray arrayWithArray:TBEquationGenerator_OperationEnum_values];
}

+ (TBEquationGenerator_OperationEnum *)valueOfWithNSString:(NSString *)name {
  for (int i = 0; i < [TBEquationGenerator_OperationEnum_values count]; i++) {
    TBEquationGenerator_OperationEnum *e = [TBEquationGenerator_OperationEnum_values objectAtIndex:i];
    if ([name isEqual:[e name]]) {
      return e;
    }
  }
  @throw [[[JavaLangIllegalArgumentException alloc] initWithNSString:name] autorelease];
  return nil;
}

@end
