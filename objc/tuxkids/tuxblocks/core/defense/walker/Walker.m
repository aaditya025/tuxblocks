//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: C:\Users\Thomas\Documents\Eclipse\Tux\tuxblocks\core\src\main\java\tuxkids\tuxblocks\core\defense\walker\Walker.java
//
//  Created by Thomas on 7/1/13.
//

#import "IOSBooleanArray.h"
#import "IOSObjectArray.h"
#import "java/lang/Math.h"
#import "java/util/ArrayList.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"
#import "playn/core/Canvas.h"
#import "playn/core/CanvasImage.h"
#import "playn/core/Graphics.h"
#import "playn/core/Layer.h"
#import "playn/core/util/Clock.h"
#import "pythagoras/f/Vector.h"
#import "pythagoras/i/Point.h"
#import "tripleplay/util/Colors.h"
#import "tuxkids/tuxblocks/core/ImageLayerTintable.h"
#import "tuxkids/tuxblocks/core/PlayNObject.h"
#import "tuxkids/tuxblocks/core/defense/DiscreteGridObject.h"
#import "tuxkids/tuxblocks/core/defense/Grid.h"
#import "tuxkids/tuxblocks/core/defense/Pathing.h"
#import "tuxkids/tuxblocks/core/defense/walker/Walker.h"
#import "tuxkids/tuxblocks/core/defense/walker/buff/Buff.h"

@implementation TBWalker

- (id<JavaUtilList>)path {
  return path_;
}
- (void)setPath:(id<JavaUtilList>)path {
  JreOperatorRetainedAssign(&path_, self, path);
}
@synthesize path = path_;
- (PythagorasIPoint *)lastCoordinates {
  return lastCoordinates_;
}
- (void)setLastCoordinates:(PythagorasIPoint *)lastCoordinates {
  JreOperatorRetainedAssign(&lastCoordinates_, self, lastCoordinates);
}
@synthesize lastCoordinates = lastCoordinates_;
- (PythagorasIPoint *)destination {
  return destination_;
}
- (void)setDestination:(PythagorasIPoint *)destination {
  JreOperatorRetainedAssign(&destination_, self, destination);
}
@synthesize destination = destination_;
- (TBImageLayerTintable *)layer_ {
  return layer__;
}
- (void)setLayer_:(TBImageLayerTintable *)layer_ {
  JreOperatorRetainedAssign(&layer__, self, layer_);
}
@synthesize layer_ = layer__;
@synthesize hp = hp_;
@synthesize alpha = alpha_;
@synthesize walkingMs = walkingMs_;
@synthesize placed = placed_;
- (PythagorasFVector *)position_ {
  return position__;
}
- (void)setPosition_:(PythagorasFVector *)position_ {
  JreOperatorRetainedAssign(&position__, self, position_);
}
@synthesize position_ = position__;
- (id<JavaUtilList>)buffs {
  return buffs_;
}
- (void)setBuffs:(id<JavaUtilList>)buffs {
  JreOperatorRetainedAssign(&buffs_, self, buffs);
}
@synthesize buffs = buffs_;

- (void)updateMovementWithFloat:(float)perc {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
}

- (int)getMaxHp {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (int)walkCellTime {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (TBWalker *)copy__ OBJC_METHOD_FAMILY_NONE {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (id<PlaynCoreLayer>)layerAddable {
  return [((TBImageLayerTintable *) NIL_CHK(layer__)) layer];
}

- (TBImageLayerTintable *)layer {
  return layer__;
}

- (PythagorasFVector *)position {
  return position__;
}

- (float)width {
  return [((TBDGrid *) NIL_CHK(grid_)) cellSize];
}

- (float)height {
  return [((TBDGrid *) NIL_CHK(grid_)) cellSize];
}

- (BOOL)isAlive {
  return hp_ > 0 && ![self destroyed];
}

- (BOOL)destroyed {
  return [((id<PlaynCoreLayer>) [((TBImageLayerTintable *) NIL_CHK(layer__)) layer]) destroyed];
}

- (void)setDepthWithFloat:(float)depth {
  [((TBImageLayerTintable *) NIL_CHK(layer__)) setDepthWithFloat:depth];
}

- (TBWalker *)placeWithTBDGrid:(TBDGrid *)grid
          withPythagorasIPoint:(PythagorasIPoint *)coordinates
          withPythagorasIPoint:(PythagorasIPoint *)desitnation
                     withFloat:(float)depth {
  [self placeWithTBDGrid:grid withFloat:depth];
  self.destination = desitnation;
  self.coordinates_ = JreOperatorRetainedAssign(&lastCoordinates_, self, coordinates);
  self.walkingMs = [self walkCellTime];
  self.hp = [self getMaxHp];
  placed_ = YES;
  JreOperatorRetainedAssign(&path_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
  [((id<JavaUtilList>) NIL_CHK(path_)) addAllWithJavaUtilCollection:[((TBDGrid *) NIL_CHK(grid)) currentPath]];
  (void) [((id<JavaUtilList>) NIL_CHK(path_)) removeWithInt:0];
  [self createSprite];
  [self updateWithInt:0];
  return self;
}

- (void)createSprite {
  id<PlaynCoreCanvasImage> image = [((id<PlaynCoreGraphics>) [TBPlayNObject graphics]) createImageWithFloat:[((TBDGrid *) NIL_CHK(grid_)) cellSize] withFloat:[((TBDGrid *) NIL_CHK(grid_)) cellSize]];
  (void) [((id<PlaynCoreCanvas>) [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas]) setFillColorWithInt:[TripleplayUtilColors WHITE]];
  (void) [((id<PlaynCoreCanvas>) [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas]) setStrokeColorWithInt:[TripleplayUtilColors BLACK]];
  int border = (int) ([((TBDGrid *) NIL_CHK(grid_)) cellSize] * 0.1f);
  (void) [((id<PlaynCoreCanvas>) [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas]) fillRectWithFloat:border withFloat:border withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) width] - border * 2 withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) height] - border * 2];
  (void) [((id<PlaynCoreCanvas>) [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas]) strokeRectWithFloat:border withFloat:border withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) width] - 1 - border * 2 withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) height] - 1 - border * 2];
  JreOperatorRetainedAssign(&layer__, self, [[[TBImageLayerTintable alloc] initWithPlaynCoreImage:image] autorelease]);
  [self updateWithInt:0];
}

- (void)refreshPath {
  JreOperatorRetainedAssign(&path_, self, [TBDPathing getPathWithTBDGrid:grid_ withPythagorasIPoint:coordinates__ withPythagorasIPoint:destination_]);
  (void) [((id<JavaUtilList>) NIL_CHK(path_)) removeWithInt:0];
}

- (float)depthRow {
  return ((PythagorasFVector *) NIL_CHK(position__)).y_ / [((TBDGrid *) NIL_CHK(grid_)) cellSize];
}

- (float)depthCol {
  return ((PythagorasFVector *) NIL_CHK(position__)).x_ / [((TBDGrid *) NIL_CHK(grid_)) cellSize];
}

- (BOOL)updateWithInt:(int)delta {
  [super updateWithInt:delta];
  if (hp_ == 0) {
    if ([((TBImageLayerTintable *) NIL_CHK(layer__)) alpha] < 0.01f) {
      [((TBImageLayerTintable *) NIL_CHK(layer__)) destroy];
      return YES;
    }
    return NO;
  }
  if (walkingMs_ >= [self walkCellTime]) {
    walkingMs_ -= [self walkCellTime];
    if ([((id<JavaUtilList>) NIL_CHK(path_)) size] > 0) {
      JreOperatorRetainedAssign(&lastCoordinates_, self, coordinates__);
      PythagorasIPoint *nLoc = ((PythagorasIPoint *) [((id<JavaUtilList>) NIL_CHK(path_)) removeWithInt:0]);
      if (![((IOSBooleanArray *) [[((TBDGrid *) NIL_CHK(grid_)) getPassability] objectAtIndex:((PythagorasIPoint *) NIL_CHK(nLoc)).x_]) booleanAtIndex:((PythagorasIPoint *) NIL_CHK(nLoc)).y_]) {
        [self refreshPath];
        nLoc = ((PythagorasIPoint *) [((id<JavaUtilList>) NIL_CHK(path_)) removeWithInt:0]);
      }
      JreOperatorRetainedAssign(&coordinates__, self, nLoc);
    }
    else {
      [((TBImageLayerTintable *) NIL_CHK(layer__)) destroy];
      return YES;
    }
  }
  [((TBImageLayerTintable *) NIL_CHK(layer__)) setTintWithInt:[TripleplayUtilColors WHITE] withInt:[((TBDGrid *) NIL_CHK(grid_)) towerColor] withFloat:(float) hp_ / [self getMaxHp]];
  [((TBImageLayerTintable *) NIL_CHK(layer__)) setAlphaWithFloat:alpha_];
  for (int i = 0; i < [((id<JavaUtilList>) NIL_CHK(buffs_)) size]; i++) {
    TBBuff *buff = ((TBBuff *) [((id<JavaUtilList>) NIL_CHK(buffs_)) getWithInt:i]);
    if ([((TBBuff *) NIL_CHK(buff)) updateWithInt:delta]) {
      (void) [((id<JavaUtilList>) NIL_CHK(buffs_)) removeWithInt:i];
      i--;
      continue;
    }
  }
  return NO;
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  float dt = [((id<PlaynCoreUtilClock>) NIL_CHK(clock)) dt];
  if (hp_ > 0) {
    {
      id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(buffs_)) iterator]);
      while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
        TBBuff *buff = ((TBBuff *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
        dt = [((TBBuff *) NIL_CHK(buff)) modifySpeedWithFloat:dt];
      }
    }
    walkingMs_ += dt;
  }
  else {
    [((TBImageLayerTintable *) NIL_CHK(layer__)) setAlphaWithFloat:[TBPlayNObject lerpTimeWithFloat:[((TBImageLayerTintable *) NIL_CHK(layer__)) alpha] withFloat:0 withFloat:0.995f withFloat:dt]];
  }
  float perc = (float) walkingMs_ / [self walkCellTime];
  (void) [((PythagorasFVector *) NIL_CHK(position__)) setWithFloat:([TBPlayNObject lerpWithFloat:((PythagorasIPoint *) NIL_CHK(coordinates__)).y_ withFloat:((PythagorasIPoint *) NIL_CHK(lastCoordinates_)).y_ withFloat:1 - perc] + 0.5f) * [((TBDGrid *) NIL_CHK(grid_)) cellSize] withFloat:([TBPlayNObject lerpWithFloat:((PythagorasIPoint *) NIL_CHK(coordinates__)).x_ withFloat:((PythagorasIPoint *) NIL_CHK(lastCoordinates_)).x_ withFloat:1 - perc] + 0.5f) * [((TBDGrid *) NIL_CHK(grid_)) cellSize]];
  [self updateMovementWithFloat:perc];
}

- (void)damageWithFloat:(float)damage {
  hp_ -= damage;
  hp_ = [JavaLangMath maxWithFloat:hp_ withFloat:0];
}

- (void)addBuffWithTBBuff:(TBBuff *)buff
                 withBOOL:(BOOL)replaceIfPresent {
  if (replaceIfPresent && [((id<JavaUtilList>) NIL_CHK(buffs_)) containsWithId:buff]) {
    [((id<JavaUtilList>) NIL_CHK(buffs_)) removeWithId:buff];
  }
  [((id<JavaUtilList>) NIL_CHK(buffs_)) addWithId:buff];
}

- (id)init {
  if ((self = [super init])) {
    alpha_ = 1;
    JreOperatorRetainedAssign(&position__, self, [[[PythagorasFVector alloc] init] autorelease]);
    JreOperatorRetainedAssign(&buffs_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&buffs_, self, nil);
  JreOperatorRetainedAssign(&position__, self, nil);
  JreOperatorRetainedAssign(&layer__, self, nil);
  JreOperatorRetainedAssign(&destination_, self, nil);
  JreOperatorRetainedAssign(&lastCoordinates_, self, nil);
  JreOperatorRetainedAssign(&path_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TBWalker *typedCopy = (TBWalker *) copy;
  typedCopy.path = path_;
  typedCopy.lastCoordinates = lastCoordinates_;
  typedCopy.destination = destination_;
  typedCopy.layer_ = layer__;
  typedCopy.hp = hp_;
  typedCopy.alpha = alpha_;
  typedCopy.walkingMs = walkingMs_;
  typedCopy.placed = placed_;
  typedCopy.position_ = position__;
  typedCopy.buffs = buffs_;
}

@end
