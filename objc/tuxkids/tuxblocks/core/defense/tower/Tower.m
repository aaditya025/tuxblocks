//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: C:\Users\Thomas\Documents\Eclipse\Tux\tuxblocks\core\src\main\java\tuxkids\tuxblocks\core\defense\tower\Tower.java
//
//  Created by Thomas on 7/1/13.
//

#import "IOSBooleanArray.h"
#import "IOSObjectArray.h"
#import "java/lang/Math.h"
#import "java/util/ArrayList.h"
#import "java/util/List.h"
#import "playn/core/Canvas.h"
#import "playn/core/CanvasImage.h"
#import "playn/core/Color.h"
#import "playn/core/Graphics.h"
#import "playn/core/Image.h"
#import "playn/core/Layer.h"
#import "playn/core/PlayN.h"
#import "playn/core/util/Clock.h"
#import "pythagoras/f/Vector.h"
#import "pythagoras/i/Point.h"
#import "tripleplay/util/Colors.h"
#import "tuxkids/tuxblocks/core/ImageLayerTintable.h"
#import "tuxkids/tuxblocks/core/defense/DiscreteGridObject.h"
#import "tuxkids/tuxblocks/core/defense/Grid.h"
#import "tuxkids/tuxblocks/core/defense/projectile/Projectile.h"
#import "tuxkids/tuxblocks/core/defense/tower/Tower.h"
#import "tuxkids/tuxblocks/core/defense/tower/TowerType.h"
#import "tuxkids/tuxblocks/core/defense/walker/Walker.h"
#import "tuxkids/tuxblocks/core/utils/CanvasUtils.h"

@implementation TBTower

static id<JavaUtilList> TBTower_towerBag_;

- (TBImageLayerTintable *)layer_ {
  return layer__;
}
- (void)setLayer_:(TBImageLayerTintable *)layer_ {
  JreOperatorRetainedAssign(&layer__, self, layer_);
}
@synthesize layer_ = layer__;
@synthesize fireTimer = fireTimer_;
- (PythagorasFVector *)position_ {
  return position__;
}
- (void)setPosition_:(PythagorasFVector *)position_ {
  JreOperatorRetainedAssign(&position__, self, position_);
}
@synthesize position_ = position__;
@synthesize id_ = id__;
- (TBWalker *)lastTarget_ {
  return lastTarget__;
}
- (void)setLastTarget_:(TBWalker *)lastTarget_ {
  JreOperatorRetainedAssign(&lastTarget__, self, lastTarget_);
}
@synthesize lastTarget_ = lastTarget__;

+ (id<JavaUtilList>)towerBag {
  return TBTower_towerBag_;
}

- (int)rows {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (int)cols {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (float)damage {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (int)fireRate {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (float)range {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (TBProjectile *)createProjectile {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (TBTower *)copy__ OBJC_METHOD_FAMILY_NONE {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (NSString *)name {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (int)cost {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (int)commonness {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

+ (TBTowerTypeEnum *)getTypeByIndexWithInt:(int)index {
  return ((TBTowerTypeEnum *) [[TBTowerTypeEnum values] objectAtIndex:index]);
}

- (float)splashRadius {
  return 0;
}

- (float)baseWidth {
  return [self cols] * [((TBDGrid *) NIL_CHK(grid_)) cellSize];
}

- (float)baseHeight {
  return [self rows] * [((TBDGrid *) NIL_CHK(grid_)) cellSize];
}

- (float)width {
  return [((TBImageLayerTintable *) NIL_CHK(layer__)) width];
}

- (float)height {
  return [((TBImageLayerTintable *) NIL_CHK(layer__)) height];
}

- (TBImageLayerTintable *)layer {
  return layer__;
}

- (id<PlaynCoreLayer>)layerAddable {
  return [((TBImageLayerTintable *) NIL_CHK(layer__)) layer];
}

- (PythagorasFVector *)position {
  return position__;
}

- (PythagorasFVector *)projectileStart {
  return position__;
}

- (int)id__ {
  return id__;
}

+ (TBTowerTypeEnum *)randomTower {
  return ((TBTowerTypeEnum *) [((id<JavaUtilList>) NIL_CHK(TBTower_towerBag_)) getWithInt:(int) ([JavaLangMath random] * [((id<JavaUtilList>) NIL_CHK(TBTower_towerBag_)) size])]);
}

+ (int)towerCount {
  return (int) [[TBTowerTypeEnum values] count];
}

- (void)addBuffsWithTBWalker:(TBWalker *)walker {
}

- (TBWalker *)lastTarget {
  return lastTarget__;
}

- (void)setLastTargetWithTBWalker:(TBWalker *)target {
  JreOperatorRetainedAssign(&lastTarget__, self, target);
}

- (void)setCoordinatesWithPythagorasIPoint:(PythagorasIPoint *)coordinates {
  [self setCoordinatesWithInt:((PythagorasIPoint *) NIL_CHK(coordinates)).x_ withInt:((PythagorasIPoint *) NIL_CHK(coordinates)).y_];
}

- (void)setCoordinatesWithInt:(int)row
                      withInt:(int)col {
  [((PythagorasIPoint *) NIL_CHK(coordinates__)) setLocationWithInt:row withInt:col];
  [((TBImageLayerTintable *) NIL_CHK(layer__)) setTranslationWithFloat:col * [((TBDGrid *) NIL_CHK(grid_)) cellSize] + ([self baseWidth] - [self width]) / 2 withFloat:row * [((TBDGrid *) NIL_CHK(grid_)) cellSize] + ([self baseHeight] - [self height])];
  (void) [((PythagorasFVector *) NIL_CHK(position__)) setWithFloat:col * [((TBDGrid *) NIL_CHK(grid_)) cellSize] + [self width] / 2 withFloat:row * [((TBDGrid *) NIL_CHK(grid_)) cellSize] + [self height] / 2];
}

- (void)setDepthWithFloat:(float)depth {
  [((TBImageLayerTintable *) NIL_CHK(layer__)) setDepthWithFloat:depth];
}

- (TBTower *)previewWithTBDGrid:(TBDGrid *)grid {
  if (self.grid != nil) return self;
  self.grid = grid;
  JreOperatorRetainedAssign(&layer__, self, [[[TBImageLayerTintable alloc] initWithPlaynCoreImage:[self createImageWithFloat:[((TBDGrid *) NIL_CHK(grid)) cellSize] withInt:[TripleplayUtilColors WHITE]]] autorelease]);
  [((TBImageLayerTintable *) NIL_CHK(layer__)) setTintWithInt:[((TBDGrid *) NIL_CHK(grid)) towerColor]];
  return self;
}

- (TBTower *)placeWithTBDGrid:(TBDGrid *)grid
         withPythagorasIPoint:(PythagorasIPoint *)coordinates {
  [self placeWithTBDGrid:grid withFloat:0];
  [self setCoordinatesWithPythagorasIPoint:coordinates];
  for (int i = 0; i < [self rows]; i++) {
    for (int j = 0; j < [self cols]; j++) {
      [((IOSBooleanArray *) [[((TBDGrid *) NIL_CHK(grid)) getPassability] objectAtIndex:i + ((PythagorasIPoint *) NIL_CHK(coordinates)).x_]) replaceBooleanAtIndex:j + ((PythagorasIPoint *) NIL_CHK(coordinates)).y_ withBoolean:NO];
    }
  }
  return self;
}

- (BOOL)updateWithInt:(int)delta {
  [super updateWithInt:delta];
  int fireRate = [self fireRate];
  if (fireRate > 0 && fireTimer_ > fireRate) {
    if ([self fire]) {
      fireTimer_ -= fireRate;
    }
    else {
      fireTimer_ = fireRate;
    }
  }
  return NO;
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  fireTimer_ += [((id<PlaynCoreUtilClock>) NIL_CHK(clock)) dt];
}

- (BOOL)fire {
  return [((TBDGrid *) NIL_CHK(grid_)) fireProjectileWithTBTower:self];
}

- (BOOL)canPlaceWithInt:(int)row
                withInt:(int)col {
  for (int i = 0; i < [self rows]; i++) {
    for (int j = 0; j < [self cols]; j++) {
      if (![((IOSBooleanArray *) [[((TBDGrid *) NIL_CHK(grid_)) getPassability] objectAtIndex:i + row]) booleanAtIndex:j + col]) return NO;
    }
  }
  return YES;
}

- (id<PlaynCoreImage>)createRadiusImage {
  if ([self range] == 0) return nil;
  float rad = [self range] * [((TBDGrid *) NIL_CHK(grid_)) cellSize];
  int color = [PlaynCoreColor rgbWithInt:255 withInt:0 withInt:100];
  return [TBCanvasUtils createCircleWithFloat:rad withInt:[PlaynCoreColor withAlphaWithInt:color withInt:50] withFloat:1 withInt:color];
}

- (id<PlaynCoreImage>)createImageWithFloat:(float)cellSize
                                   withInt:(int)color {
  int width = (int) (cellSize * [self cols]), height = (int) (cellSize * [self rows]);
  int padding = (int) (cellSize * 0.1f);
  int rad = (int) ([JavaLangMath minWithInt:width withInt:height] * 0.1f);
  id<PlaynCoreCanvasImage> image = [((id<PlaynCoreGraphics>) [PlaynCorePlayN graphics]) createImageWithFloat:width withFloat:height];
  (void) [((id<PlaynCoreCanvas>) [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas]) setFillColorWithInt:color];
  (void) [((id<PlaynCoreCanvas>) [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas]) fillRoundRectWithFloat:padding withFloat:padding withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) width] - padding * 2 withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) height] - padding * 2 withFloat:rad];
  (void) [((id<PlaynCoreCanvas>) [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas]) setStrokeColorWithInt:[TripleplayUtilColors BLACK]];
  (void) [((id<PlaynCoreCanvas>) [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas]) strokeRoundRectWithFloat:padding withFloat:padding withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) width] - padding * 2 - 1 withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) height] - padding * 2 - 1 withFloat:rad];
  return image;
}

- (id)init {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&position__, self, [[[PythagorasFVector alloc] init] autorelease]);
  }
  return self;
}

+ (void)initialize {
  if (self == [TBTower class]) {
    {
      JreOperatorRetainedAssign(&TBTower_towerBag_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
      {
        IOSObjectArray *a__ = [TBTowerTypeEnum values];
        int n__ = (int) [((IOSObjectArray *) NIL_CHK(a__)) count];
        for (int i__ = 0; i__ < n__; i__++) {
          TBTowerTypeEnum *type = ((TBTowerTypeEnum *) [((IOSObjectArray *) NIL_CHK(a__)) objectAtIndex:i__]);
          for (int i = 0; i < [[((TBTowerTypeEnum *) NIL_CHK(type)) instance] commonness]; i++) [((id<JavaUtilList>) NIL_CHK(TBTower_towerBag_)) addWithId:type];
        }
      }
    }
  }
}

- (void)dealloc {
  JreOperatorRetainedAssign(&lastTarget__, self, nil);
  JreOperatorRetainedAssign(&position__, self, nil);
  JreOperatorRetainedAssign(&layer__, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TBTower *typedCopy = (TBTower *) copy;
  typedCopy.layer_ = layer__;
  typedCopy.fireTimer = fireTimer_;
  typedCopy.position_ = position__;
  typedCopy.id_ = id__;
  typedCopy.lastTarget_ = lastTarget__;
}

@end
