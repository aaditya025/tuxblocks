//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: C:\Users\Thomas\Documents\Eclipse\Tux\tuxblocks\core\src\main\java\tuxkids\tuxblocks\core\TuxBlocksGame.java
//
//  Created by Thomas on 7/1/13.
//

#import "java/lang/Math.h"
#import "playn/core/Canvas.h"
#import "playn/core/CanvasImage.h"
#import "playn/core/Color.h"
#import "playn/core/Game.h"
#import "playn/core/Graphics.h"
#import "playn/core/GroupLayer.h"
#import "playn/core/ImageLayer.h"
#import "playn/core/Layer.h"
#import "playn/core/PlayN.h"
#import "tripleplay/game/ScreenStack.h"
#import "tripleplay/game/trans/SlideTransition.h"
#import "tuxkids/tuxblocks/core/GameBackgroundSprite.h"
#import "tuxkids/tuxblocks/core/GameState.h"
#import "tuxkids/tuxblocks/core/SolidClock.h"
#import "tuxkids/tuxblocks/core/TuxBlocksGame.h"
#import "tuxkids/tuxblocks/core/defense/DefenseScreen.h"

@implementation TBTuxBlocksGame

static TBTuxBlocksGame * TBTuxBlocksGame_instance_;

- (TBSolidClock *)clock {
  return clock_;
}
- (void)setClock:(TBSolidClock *)clock {
  JreOperatorRetainedAssign(&clock_, self, clock);
}
@synthesize clock = clock_;
- (TripleplayGameScreenStack *)screens {
  return screens_;
}
- (void)setScreens:(TripleplayGameScreenStack *)screens {
  JreOperatorRetainedAssign(&screens_, self, screens);
}
@synthesize screens = screens_;
- (TBGameBackgroundSprite *)background {
  return background_;
}
- (void)setBackground:(TBGameBackgroundSprite *)background {
  JreOperatorRetainedAssign(&background_, self, background);
}
@synthesize background = background_;
@synthesize frames = frames_;
@synthesize lastUpdate = lastUpdate_;
- (id<PlaynCoreImageLayer>)fpsLayer {
  return fpsLayer_;
}
- (void)setFpsLayer:(id<PlaynCoreImageLayer>)fpsLayer {
  JreOperatorRetainedAssign(&fpsLayer_, self, fpsLayer);
}
@synthesize fpsLayer = fpsLayer_;

+ (int)UPDATE_RATE {
  return TBTuxBlocksGame_UPDATE_RATE;
}

+ (TBTuxBlocksGame *)instance {
  return TBTuxBlocksGame_instance_;
}

+ (void)setInstance:(TBTuxBlocksGame *)instance {
  JreOperatorRetainedAssign(&TBTuxBlocksGame_instance_, self, instance);
}

+ (int)screenDepth {
  return [((TripleplayGameScreenStack *) NIL_CHK(TBTuxBlocksGame_instance_.screens)) size];
}

- (id)init {
  if ((self = [super initWithInt:TBTuxBlocksGame_UPDATE_RATE])) {
    JreOperatorRetainedAssign(&clock_, self, [[[TBSolidClock alloc] initWithInt:TBTuxBlocksGame_UPDATE_RATE] autorelease]);
    JreOperatorRetainedAssign(&screens_, self, [[[TBTuxBlocksGame_$1 alloc] init] autorelease]);
    JreOperatorRetainedAssign(&TBTuxBlocksGame_instance_, self, self);
  }
  return self;
}

- (void)init__ OBJC_METHOD_FAMILY_NONE {
  TBGameState *state = [[[TBGameState alloc] init] autorelease];
  JreOperatorRetainedAssign(&background_, self, [((TBGameState *) NIL_CHK(state)) background]);
  (void) [((id<PlaynCoreGroupLayer>) [((TBGameBackgroundSprite *) NIL_CHK(background_)) layer]) setDepthWithFloat:-10];
  [((id<PlaynCoreGroupLayer>) [((id<PlaynCoreGraphics>) [PlaynCorePlayN graphics]) rootLayer]) addWithPlaynCoreLayer:[((TBGameBackgroundSprite *) NIL_CHK(background_)) layer]];
  [((TripleplayGameScreenStack *) NIL_CHK(screens_)) pushWithTripleplayGameScreen:[[[TBDDefenseScreen alloc] initWithTripleplayGameScreenStack:screens_ withTBGameState:state] autorelease]];
}

- (void)updateFPS {
  frames_++;
  if (lastUpdate_ < [PlaynCorePlayN currentTime] - 1000) {
    lastUpdate_ = [PlaynCorePlayN currentTime];
    id<PlaynCoreCanvasImage> image = [((id<PlaynCoreGraphics>) [PlaynCorePlayN graphics]) createImageWithFloat:40 withFloat:13];
    id<PlaynCoreCanvas> canvas = [((id<PlaynCoreCanvasImage>) NIL_CHK(image)) canvas];
    (void) [((id<PlaynCoreCanvas>) NIL_CHK(canvas)) setFillColorWithInt:[PlaynCoreColor rgbWithInt:50 withInt:50 withInt:50]];
    (void) [((id<PlaynCoreCanvas>) NIL_CHK(canvas)) drawTextWithNSString:[NSString stringWithFormat:@"%d FPS", frames_] withFloat:0 withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) height]];
    if (fpsLayer_ != nil) [((id<PlaynCoreGroupLayer>) [((id<PlaynCoreGraphics>) [PlaynCorePlayN graphics]) rootLayer]) removeWithPlaynCoreLayer:fpsLayer_];
    JreOperatorRetainedAssign(&fpsLayer_, self, [((id<PlaynCoreGraphics>) [PlaynCorePlayN graphics]) createImageLayerWithPlaynCoreImage:image]);
    (void) [((id<PlaynCoreImageLayer>) NIL_CHK(fpsLayer_)) setDepthWithFloat:10000];
    [((id<PlaynCoreGroupLayer>) [((id<PlaynCoreGraphics>) [PlaynCorePlayN graphics]) rootLayer]) addWithPlaynCoreLayer:fpsLayer_];
    frames_ = 0;
  }
}

- (void)updateWithInt:(int)delta {
  delta = [JavaLangMath minWithInt:delta withInt:TBTuxBlocksGame_MAX_DELTA];
  [((TBSolidClock *) NIL_CHK(clock_)) updateWithInt:delta];
  [((TBGameBackgroundSprite *) NIL_CHK(background_)) updateWithInt:delta];
  [((TripleplayGameScreenStack *) NIL_CHK(screens_)) updateWithInt:delta];
}

- (void)paintWithFloat:(float)alpha {
  [((TBSolidClock *) NIL_CHK(clock_)) paintWithFloat:alpha];
  [((TBGameBackgroundSprite *) NIL_CHK(background_)) paintWithPlaynCoreUtilClock:clock_];
  [((TripleplayGameScreenStack *) NIL_CHK(screens_)) paintWithPlaynCoreUtilClock:clock_];
  [self updateFPS];
}

- (void)dealloc {
  JreOperatorRetainedAssign(&fpsLayer_, self, nil);
  JreOperatorRetainedAssign(&background_, self, nil);
  JreOperatorRetainedAssign(&screens_, self, nil);
  JreOperatorRetainedAssign(&clock_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TBTuxBlocksGame *typedCopy = (TBTuxBlocksGame *) copy;
  typedCopy.clock = clock_;
  typedCopy.screens = screens_;
  typedCopy.background = background_;
  typedCopy.frames = frames_;
  typedCopy.lastUpdate = lastUpdate_;
  typedCopy.fpsLayer = fpsLayer_;
}

@end
@implementation TBTuxBlocksGame_$1

- (id<TripleplayGameScreenStack_Transition>)defaultPushTransition {
  return [self slide];
}

- (id<TripleplayGameScreenStack_Transition>)defaultPopTransition {
  return [[self slide] right];
}

- (id)init {
  return [super init];
}

- (void)dealloc {
  [super dealloc];
}

@end
