//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: C:\Users\Thomas\Documents\Eclipse\Tux\tuxblocks\core\src\main\java\tuxkids\tuxblocks\core\GameBackgroundSprite.java
//
//  Created by Thomas on 7/1/13.
//

#import "IOSDoubleArray.h"
#import "java/lang/Math.h"
#import "java/util/ArrayList.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"
#import "playn/core/CanvasImage.h"
#import "playn/core/Graphics.h"
#import "playn/core/GroupLayer.h"
#import "playn/core/ImageLayer.h"
#import "playn/core/Layer.h"
#import "playn/core/util/Clock.h"
#import "pythagoras/f/Vector.h"
#import "tripleplay/util/Colors.h"
#import "tuxkids/tuxblocks/core/GameBackgroundSprite.h"
#import "tuxkids/tuxblocks/core/PlayNObject.h"
#import "tuxkids/tuxblocks/core/utils/CanvasUtils.h"
#import "tuxkids/tuxblocks/core/utils/Sobol.h"

@implementation TBGameBackgroundSprite

- (id<PlaynCoreGroupLayer>)groupLayer {
  return groupLayer_;
}
- (void)setGroupLayer:(id<PlaynCoreGroupLayer>)groupLayer {
  JreOperatorRetainedAssign(&groupLayer_, self, groupLayer);
}
@synthesize groupLayer = groupLayer_;
- (id<JavaUtilList>)backgroundSprites {
  return backgroundSprites_;
}
- (void)setBackgroundSprites:(id<JavaUtilList>)backgroundSprites {
  JreOperatorRetainedAssign(&backgroundSprites_, self, backgroundSprites);
}
@synthesize backgroundSprites = backgroundSprites_;
- (id<JavaUtilList>)toRemove {
  return toRemove_;
}
- (void)setToRemove:(id<JavaUtilList>)toRemove {
  JreOperatorRetainedAssign(&toRemove_, self, toRemove);
}
@synthesize toRemove = toRemove_;
@synthesize rectTimer = rectTimer_;
@synthesize primaryColor_ = primaryColor__;
@synthesize primaryHue = primaryHue_;
- (PythagorasFVector *)offset {
  return offset_;
}
- (void)setOffset:(PythagorasFVector *)offset {
  JreOperatorRetainedAssign(&offset_, self, offset);
}
@synthesize offset = offset_;
- (TBSobol *)sobolD5 {
  return sobolD5_;
}
- (void)setSobolD5:(TBSobol *)sobolD5 {
  JreOperatorRetainedAssign(&sobolD5_, self, sobolD5);
}
@synthesize sobolD5 = sobolD5_;

- (float)width {
  return [((id<PlaynCoreGraphics>) [TBPlayNObject graphics]) width];
}

- (float)height {
  return [((id<PlaynCoreGraphics>) [TBPlayNObject graphics]) height];
}

- (id<PlaynCoreGroupLayer>)layer {
  return groupLayer_;
}

- (int)primaryColor {
  return primaryColor__;
}

- (void)scrollWithFloat:(float)x
              withFloat:(float)y {
  ((PythagorasFVector *) NIL_CHK(offset_)).x_ += x;
  ((PythagorasFVector *) NIL_CHK(offset_)).y_ += y;
}

- (id)init {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&backgroundSprites_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
    JreOperatorRetainedAssign(&toRemove_, self, [[[JavaUtilArrayList alloc] init] autorelease]);
    JreOperatorRetainedAssign(&offset_, self, [[[PythagorasFVector alloc] init] autorelease]);
    JreOperatorRetainedAssign(&sobolD5_, self, [[[TBSobol alloc] initWithInt:5] autorelease]);
    JreOperatorRetainedAssign(&groupLayer_, self, [((id<PlaynCoreGraphics>) [TBPlayNObject graphics]) createGroupLayer]);
    (void) [((id<PlaynCoreGroupLayer>) NIL_CHK(groupLayer_)) setDepthWithFloat:-100];
    [self newThemeColor];
    [self updateWithInt:0];
  }
  return self;
}

- (void)createBackgroundSprite {
  TBGameBackgroundSprite_BackgroundSprite *sprite = [[[TBGameBackgroundSprite_BackgroundSprite alloc] initWithTBGameBackgroundSprite:self withFloat:primaryHue_ withFloat:(float) [((id<JavaUtilList>) NIL_CHK(backgroundSprites_)) size] / 20] autorelease];
  [((id<JavaUtilList>) NIL_CHK(backgroundSprites_)) addWithId:sprite];
  [((id<PlaynCoreGroupLayer>) NIL_CHK(groupLayer_)) addWithPlaynCoreLayer:((TBGameBackgroundSprite_BackgroundSprite *) NIL_CHK(sprite)).layer];
}

- (void)removeBackgroundSprite {
  [((TBGameBackgroundSprite_BackgroundSprite *) [((id<JavaUtilList>) NIL_CHK(backgroundSprites_)) getWithInt:(int) ([JavaLangMath random] * [((id<JavaUtilList>) NIL_CHK(backgroundSprites_)) size])]) beginRemove];
}

- (void)newThemeColor OBJC_METHOD_FAMILY_NONE {
  primaryHue_ = (float) [JavaLangMath random];
  primaryColor__ = [TBCanvasUtils hsvToRgbWithFloat:primaryHue_ withFloat:1 withFloat:1];
}

- (void)updateWithInt:(int)delta {
  rectTimer_ += delta;
  if ([((id<JavaUtilList>) NIL_CHK(backgroundSprites_)) size] < TBGameBackgroundSprite_MAX_RECTS) {
    if (rectTimer_ >= TBGameBackgroundSprite_CREATE_RECT_INTERVAL) {
      rectTimer_ -= TBGameBackgroundSprite_CREATE_RECT_INTERVAL;
      [self createBackgroundSprite];
    }
  }
  else {
    if (rectTimer_ >= TBGameBackgroundSprite_REMOVE_RECT_INTERVAL) {
      rectTimer_ -= TBGameBackgroundSprite_REMOVE_RECT_INTERVAL;
      [self removeBackgroundSprite];
    }
  }
}

- (void)paintWithPlaynCoreUtilClock:(id<PlaynCoreUtilClock>)clock {
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(backgroundSprites_)) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      TBGameBackgroundSprite_BackgroundSprite *bg = ((TBGameBackgroundSprite_BackgroundSprite *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      [((TBGameBackgroundSprite_BackgroundSprite *) NIL_CHK(bg)) updateWithInt:(int) [((id<PlaynCoreUtilClock>) NIL_CHK(clock)) dt]];
    }
  }
  [((id<JavaUtilList>) NIL_CHK(backgroundSprites_)) removeAllWithJavaUtilCollection:toRemove_];
  [((id<JavaUtilList>) NIL_CHK(toRemove_)) clear];
}

- (void)dealloc {
  JreOperatorRetainedAssign(&sobolD5_, self, nil);
  JreOperatorRetainedAssign(&offset_, self, nil);
  JreOperatorRetainedAssign(&toRemove_, self, nil);
  JreOperatorRetainedAssign(&backgroundSprites_, self, nil);
  JreOperatorRetainedAssign(&groupLayer_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TBGameBackgroundSprite *typedCopy = (TBGameBackgroundSprite *) copy;
  typedCopy.groupLayer = groupLayer_;
  typedCopy.backgroundSprites = backgroundSprites_;
  typedCopy.toRemove = toRemove_;
  typedCopy.rectTimer = rectTimer_;
  typedCopy.primaryColor_ = primaryColor__;
  typedCopy.primaryHue = primaryHue_;
  typedCopy.offset = offset_;
  typedCopy.sobolD5 = sobolD5_;
}

@end
@implementation TBGameBackgroundSprite_BackgroundSprite

- (TBGameBackgroundSprite *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TBGameBackgroundSprite *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (id<PlaynCoreImageLayer>)layer {
  return layer_;
}
- (void)setLayer:(id<PlaynCoreImageLayer>)layer {
  JreOperatorRetainedAssign(&layer_, self, layer);
}
@synthesize layer = layer_;
@synthesize depth = depth_;
- (PythagorasFVector *)originalPos {
  return originalPos_;
}
- (void)setOriginalPos:(PythagorasFVector *)originalPos {
  JreOperatorRetainedAssign(&originalPos_, self, originalPos);
}
@synthesize originalPos = originalPos_;
@synthesize maxAlpha = maxAlpha_;
@synthesize removing = removing_;

- (id)initWithTBGameBackgroundSprite:(TBGameBackgroundSprite *)outer$
                           withFloat:(float)hue
                           withFloat:(float)r {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    IOSDoubleArray *point = [((TBSobol *) NIL_CHK(outer$.sobolD5)) nextPoint];
    int size = (int) ([((IOSDoubleArray *) NIL_CHK(point)) doubleAtIndex:0] * 250 + 50);
    r = (float) [((IOSDoubleArray *) NIL_CHK(point)) doubleAtIndex:4];
    float h = hue;
    if (r < 1.0f / 3) {
      h = h + 0.7f;
    }
    else if (r < 2.0f / 3) {
      h = h + 0.3f;
    }
    float s = (float) [JavaLangMath random] * 0.5f + 0.5f;
    float v = (float) [JavaLangMath random] * 0.3f + 0.4f;
    id<PlaynCoreCanvasImage> image = [TBCanvasUtils createRectWithFloat:size withFloat:size withInt:[TBCanvasUtils hsvToRgbWithFloat:h withFloat:s withFloat:v] withFloat:1 withInt:[TripleplayUtilColors DARK_GRAY]];
    JreOperatorRetainedAssign(&layer_, self, [((id<PlaynCoreGraphics>) [TBPlayNObject graphics]) createImageLayerWithPlaynCoreImage:image]);
    maxAlpha_ = (float) [JavaLangMath random] * 0.4f + 0.4f;
    (void) [((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) setAlphaWithFloat:0];
    (void) [((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) setOriginWithFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) width] / 2 withFloat:[((id<PlaynCoreCanvasImage>) NIL_CHK(image)) height] / 2];
    JreOperatorRetainedAssign(&originalPos_, self, [[[PythagorasFVector alloc] initWithFloat:[outer$ width] * ((float) [((IOSDoubleArray *) NIL_CHK(point)) doubleAtIndex:1] * 1.6f - 0.3f) withFloat:((float) [((IOSDoubleArray *) NIL_CHK(point)) doubleAtIndex:2] * 1.6f - 0.3f) * [outer$ height]] autorelease]);
    (void) [((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) setTranslationWithFloat:((PythagorasFVector *) NIL_CHK(originalPos_)).x_ withFloat:((PythagorasFVector *) NIL_CHK(originalPos_)).y_];
    depth_ = (float) [((IOSDoubleArray *) NIL_CHK(point)) doubleAtIndex:3] * 15 + 5;
    (void) [((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) setDepthWithFloat:-depth_];
  }
  return self;
}

- (void)updateWithInt:(int)delta {
  (void) [((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) setTranslationWithFloat:((PythagorasFVector *) NIL_CHK(originalPos_)).x_ + ((PythagorasFVector *) NIL_CHK(this$0_.offset)).x_ / depth_ withFloat:((PythagorasFVector *) NIL_CHK(originalPos_)).y_ + ((PythagorasFVector *) NIL_CHK(this$0_.offset)).y_ / depth_];
  float targetAlpha = removing_ ? 0 : maxAlpha_;
  (void) [((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) setAlphaWithFloat:[TBPlayNObject lerpTimeWithFloat:[((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) alpha] withFloat:targetAlpha withFloat:0.999f withFloat:delta]];
  if (removing_ && [((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) alpha] < 0.01f) {
    [((id<PlaynCoreImageLayer>) NIL_CHK(layer_)) destroy];
    [((id<JavaUtilList>) NIL_CHK(this$0_.toRemove)) addWithId:self];
  }
}

- (void)beginRemove {
  removing_ = YES;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&originalPos_, self, nil);
  JreOperatorRetainedAssign(&layer_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TBGameBackgroundSprite_BackgroundSprite *typedCopy = (TBGameBackgroundSprite_BackgroundSprite *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.layer = layer_;
  typedCopy.depth = depth_;
  typedCopy.originalPos = originalPos_;
  typedCopy.maxAlpha = maxAlpha_;
  typedCopy.removing = removing_;
}

@end
