//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: react/AbstractValue.java
//
//  Created by Thomas on 7/1/13.
//

#import "IOSClass.h"
#import "java/lang/Error.h"
#import "java/lang/RuntimeException.h"
#import "java/lang/Throwable.h"
#import "java/lang/UnsupportedOperationException.h"
#import "react/Connection.h"
#import "react/Cons.h"
#import "react/Function.h"
#import "react/MultiFailureException.h"
#import "react/Reactor.h"
#import "react/ValueView.h"

@implementation ReactAbstractValue

- (id<ReactValueView>)mapWithReactFunction:(id<ReactFunction>)func {
  ReactAbstractValue *outer = self;
  return [[[ReactAbstractValue_$1 alloc] initWithReactFunction:func withReactAbstractValue:outer] autorelease];
}

- (id<ReactConnection>)connectWithReactValueView_Listener:(ReactValueView_Listener *)listener {
  ReactValueView_Listener *casted = (ReactValueView_Listener *) listener;
  return ((ReactCons *) [self addConnectionWithId:casted]);
}

- (id<ReactConnection>)connectNotifyWithReactValueView_Listener:(ReactValueView_Listener *)listener {
  id<ReactConnection> conn = [self connectWithReactValueView_Listener:listener];
  @try {
    [((ReactValueView_Listener *) NIL_CHK(listener)) onChangeWithId:[self get] withId:nil];
    return conn;
  }
  @catch (JavaLangRuntimeException *re) {
    [((id<ReactConnection>) NIL_CHK(conn)) disconnect];
    @throw re;
  }
  @catch (JavaLangError *e) {
    [((id<ReactConnection>) NIL_CHK(conn)) disconnect];
    @throw e;
  }
}

- (void)disconnectWithReactValueView_Listener:(ReactValueView_Listener *)listener {
  ReactValueView_Listener *casted = (ReactValueView_Listener *) listener;
  [self removeConnectionWithId:casted];
}

- (NSUInteger)hash {
  id value = [self get];
  return (value == nil) ? 0 : [NIL_CHK(value) hash];
}

- (BOOL)isEqual:(id)other {
  if (other == nil) return NO;
  if ([NIL_CHK(other) getClass] != [self getClass]) return NO;
  id value = [self get];
  id ovalue = [((ReactAbstractValue *) other) get];
  return [ReactReactor areEqualWithId:value withId:ovalue];
}

- (NSString *)description {
  NSString *cname = [[self getClass] getName];
  return [NSString stringWithFormat:@"%@(%@)", [NIL_CHK(cname) substring:[NIL_CHK(cname) lastIndexOfString:@"."] + 1], [self get]];
}

- (id)updateAndNotifyIfWithId:(id)value {
  return [self updateAndNotifyWithId:value withBOOL:NO];
}

- (id)updateAndNotifyWithId:(id)value {
  return [self updateAndNotifyWithId:value withBOOL:YES];
}

- (id)updateAndNotifyWithId:(id)value
                   withBOOL:(BOOL)force {
  [self checkMutate];
  id ovalue = [self updateLocalWithId:value];
  if (force || ![ReactReactor areEqualWithId:value withId:ovalue]) {
    [self emitChangeWithId:value withId:ovalue];
  }
  return ovalue;
}

- (void)emitChangeWithId:(id)value
                  withId:(id)ovalue {
  [self notifyChangeWithId:value withId:ovalue];
}

- (void)notifyChangeWithId:(id)value
                    withId:(id)ovalue {
  ReactCons *lners = ((ReactCons *) [self prepareNotify]);
  ReactMultiFailureException *error = nil;
  @try {
    for (ReactCons * cons = lners; cons != nil; cons = ((ReactCons *) NIL_CHK(cons)).next) {
      @try {
        [((ReactValueView_Listener *) NIL_CHK(cons.listener)) onChangeWithId:value withId:ovalue];
      }
      @catch (JavaLangThrowable *t) {
        if (error == nil) error = [[[ReactMultiFailureException alloc] init] autorelease];
        [((ReactMultiFailureException *) NIL_CHK(error)) addFailureWithJavaLangThrowable:t];
      }
      if (((ReactCons *) NIL_CHK(cons)).oneShot) [((ReactCons *) NIL_CHK(cons)) disconnect];
    }
  }
  @finally {
    [self finishNotifyWithReactCons:lners];
  }
  if (error != nil) [error trigger];
}

- (id)updateLocalWithId:(id)value {
  @throw [[[JavaLangUnsupportedOperationException alloc] init] autorelease];
}

- (id)get {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (id)init {
  return [super init];
}

- (void)dealloc {
  [super dealloc];
}

@end
@implementation ReactAbstractValue_$1

- (id<ReactFunction>)val$func {
  return val$func_;
}
- (void)setVal$func:(id<ReactFunction>)val$func {
  JreOperatorRetainedAssign(&val$func_, self, val$func);
}
@synthesize val$func = val$func_;
- (ReactAbstractValue *)val$outer {
  return val$outer_;
}
- (void)setVal$outer:(ReactAbstractValue *)val$outer {
  JreOperatorRetainedAssign(&val$outer_, self, val$outer);
}
@synthesize val$outer = val$outer_;

- (id)get {
  return [((id<ReactFunction>) NIL_CHK(val$func_)) applyWithId:[((ReactAbstractValue *) NIL_CHK(val$outer_)) get]];
}

- (id<ReactConnection>)connect {
  return [((ReactAbstractValue *) NIL_CHK(val$outer_)) connectWithReactValueView_Listener:[[[ReactAbstractValue_$1_$1 alloc] initWithReactAbstractValue_$1:self] autorelease]];
}

- (id)initWithReactFunction:(id<ReactFunction>)capture$0
     withReactAbstractValue:(ReactAbstractValue *)capture$1 {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&val$func_, self, capture$0);
    JreOperatorRetainedAssign(&val$outer_, self, capture$1);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$outer_, self, nil);
  JreOperatorRetainedAssign(&val$func_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  ReactAbstractValue_$1 *typedCopy = (ReactAbstractValue_$1 *) copy;
  typedCopy.val$func = val$func_;
  typedCopy.val$outer = val$outer_;
}

@end
@implementation ReactAbstractValue_$1_$1

- (ReactAbstractValue_$1 *)this$0 {
  return this$0_;
}
- (void)setThis$0:(ReactAbstractValue_$1 *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;

- (void)onChangeWithId:(id)value
                withId:(id)ovalue {
  [this$0_ notifyChangeWithId:[((id<ReactFunction>) NIL_CHK(this$0_.val$func)) applyWithId:value] withId:[((id<ReactFunction>) NIL_CHK(this$0_.val$func)) applyWithId:ovalue]];
}

- (id)initWithReactAbstractValue_$1:(ReactAbstractValue_$1 *)outer$ {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  ReactAbstractValue_$1_$1 *typedCopy = (ReactAbstractValue_$1_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
